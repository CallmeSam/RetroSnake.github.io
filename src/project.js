window.__require=function e(t,n,o){function a(s,c){if(!n[s]){if(!t[s]){var r=s.split("/");if(r=r[r.length-1],!t[r]){var d="function"==typeof __require&&__require;if(!c&&d)return d(r,!0);if(i)return i(r,!0);throw new Error("Cannot find module '"+s+"'")}}var h=n[s]={exports:{}};t[s][0].call(h.exports,function(e){return a(t[s][1][e]||e)},h,h.exports,e,t,n,o)}return n[s].exports}for(var i="function"==typeof __require&&__require,s=0;s<o.length;s++)a(o[s]);return a}({ColliderListener_food:[function(e,t,n){"use strict";cc._RF.push(t,"7dc87l8bFNGaZNbnhHkSnoR","ColliderListener_food");var o=e("Global");cc.Class({extends:cc.Component,onLoad:function(){},onCollisionEnter:function(e){e.tag==o.HEAD_TAG&&cc.find("Canvas/GameControl").getComponent("GameCtrl").destroyFood(this.node)}}),cc._RF.pop()},{Global:"Global"}],ColliderListener_snake:[function(e,t,n){"use strict";cc._RF.push(t,"4e4cawp341AS5PaGSgP42Bh","ColliderListener_snake");var o=e("Global");cc.Class({extends:cc.Component,onLoad:function(){},onCollisionEnter:function(e,t){if(cc.isValid(this.node.parent)){e.node.name;if(t.tag==o.SENSOR_TAG){if(e.tag==o.HEAD_TAG||e.tag==o.BODY_TAG){var n=this.node.parent.getComponent("aiCtrl");n&&(n.inDanger=!0)}}else e.tag==o.FOOD_TAG?this.node.parent.getComponent("snake").addScore():e.tag==o.HEAD_TAG?cc.isValid(e.node.parent)&&(Math.random()%2?cc.find("Canvas/GameControl").getComponent("GameCtrl").destroySnake(this.node.parent):cc.find("Canvas/GameControl").getComponent("GameCtrl").destroySnake(e.node.parent)):e.tag==o.BODY_TAG&&cc.find("Canvas/GameControl").getComponent("GameCtrl").destroySnake(this.node.parent)}}}),cc._RF.pop()},{Global:"Global"}],EventMgr:[function(e,t,n){"use strict";cc._RF.push(t,"3af6b47Vf5FJ7A21Sng138J","EventMgr"),function(){var e={},t={on:function(t,n,o){null==e[t]&&(e[t]=[]);var a={};a.func=n,a.node=o,e[t].push(a)},remove:function(t,n,o){if(e[t])for(var a=0;a<data.length;a++)data[a].node==o&&data[a].func==n&&(data.splice(a,1),--a);e[t].push(n)},removeByNode:function(t){for(var n in e)for(var o=e[n],a=0;a<o.length;a++)o[a].node==t&&(o.splice(a,1),--a)},removeByKey:function(t){delete e[t]},emit:function(t,n){if(e[t])for(var o=e[t].concat(),a=0;a<o.length;a++)o[a].node instanceof cc.Component?cc.isValid(o[a].node)&&o[a].func(n,o[a].node):o[a].func(n,o[a].node)}};window.EventMgr=t}(),cc._RF.pop()},{}],GameCtrl:[function(e,t,n){"use strict";cc._RF.push(t,"15b447hUhJBEZ4/ICe8gZL7","GameCtrl");var o=e("Global"),a=function(e,t){return Math.ceil(Math.random()*(t-e))+e};cc.Class({extends:cc.Component,properties:{speed:{default:10,type:cc.Integer},angle:{default:10,type:cc.Integer},pics:{default:null,type:cc.SpriteAtlas},foodPrefab:{default:null,type:cc.Prefab},snakeHeadPrefab:{default:null,type:cc.Prefab},snakeBodyPrefab:{default:null,type:cc.Prefab},boundryInterval:0,enemyInterval:0},onLoad:function(){o.speed=this.speed,o.angle=this.angle,o.pics=this.pics,o.boundryInterval=this.boundryInterval,o.enemyInterval=this.enemyInterval,cc.director.getCollisionManager().enabled=!0,cc.director.getCollisionManager().enabledDebugDraw=!0,cc.director.getCollisionManager().enabledDrawBoundingBox=!0;var e=cc.find("Canvas/bg_3");o.mapRect=new cc.Rect(e.x-e.width,e.y-e.height,2*e.width,2*e.height),this.foodPool=new cc.NodePool("foodPool"),this.headPool=new cc.NodePool("headPool"),this.bodyPool=new cc.NodePool("bodyPool"),this.usefulGroupName=["snake1","snake2","snake3","snake4","snake5"],this.refreshFoodCount=0,this.refreshSnakeCount=0,this.maxFoodNum=200},start:function(){},addGroupName:function(e){this.usefulGroupName.push(e)},popFrontGroupName:function(){return this.usefulGroupName.shift()},generateFood:function(){var e=this.foodPool.get();e||(e=cc.instantiate(this.foodPrefab)),e.parent=cc.find("Canvas/foodCollection"),e.getComponent(cc.Sprite).spriteFrame=this.pics.getSpriteFrame(""+(Math.floor(10*Math.random())+1)),e.position=new cc.Vec2(a(o.mapRect.xMin+20,o.mapRect.xMax-20),a(o.mapRect.yMin+20,o.mapRect.yMax-20))},generateSnake:function(e){var t=new cc.Node;t.name=e?"role":"snake",t.parent=cc.find("Canvas/snakeCollection");var n=this.headPool.get(),i=this.bodyPool.get();n=n||cc.instantiate(this.snakeHeadPrefab),(i=i||cc.instantiate(this.snakeBodyPrefab)).getComponent("snake_body").clearData(),n.parent=t,i.parent=t;var s=t.addComponent("snake"),c=e?"playerCtrl":"aiCtrl",r=e?cc.Vec2.ZERO:new cc.Vec2(a(o.mapRect.xMin+100,o.mapRect.xMax-100),a(o.mapRect.yMin+20,o.mapRect.yMax-100)),d=e?"snake":this.popFrontGroupName();return t.addComponent(c),s.setSkin(a(o.SnakeSkin.Brown,o.SnakeSkin.Pikachu)),s.setPos(r),n.group=d,i.group=d,t},getSnakeBody:function(){var e=this.bodyPool.get();return(e=e||cc.instantiate(this.snakeBodyPrefab)).getComponent("snake_body").clearData(),e},destroySnake:function(e){var t=!1,n=e.getChildByName("head");if(n){var o=n.group;"snake"==o&&(t=!0),this.addGroupName(o);var a=e.getComponent("snake").bodyList;this.headPool.put(a[0]);for(var i=1;i<a.length;i++)this.bodyPool.put(a[i]);e.destroy(),t&&(cc.find("Canvas/btn_acc").getComponent("buttonAcc").removeTarget(),cc.find("Canvas/Snake Camera").getComponent("SnakeCamera").removeNode(),this.restartGame())}},destroyFood:function(e){this.foodPool.put(e)},startGame:function(){this.refreshFoodCount=0,this.refreshSnakeCount=0},restartGame:function(){for(var e=cc.find("Canvas/foodCollection"),t=0;t<e.childrenCount;t++)this.destroyFood(e.children[t]);e=cc.find("Canvas/snakeCollection");for(var n=0;n<e.childrenCount;n++)cc.isValid(e.children[n])&&this.destroySnake(e.children[n]);this.usefulGroupName=["snake1","snake2","snake3","snake4","snake5"],this.refreshFoodCount=1,this.refreshSnakeCount=1;this.scheduleOnce(function(){var e=this.generateSnake(!0);cc.find("Canvas/Snake Camera").getComponent("SnakeCamera").setTarget(e.getChildByName("head")),cc.find("Canvas/btn_acc").getComponent("buttonAcc").setTarget(e)},.1)},update:function(e){if(this.refreshFoodCount-=e,this.refreshFoodCount<=0)if(cc.find("Canvas/foodCollection").childrenCount<this.maxFoodNum)for(var t=0;t<=10;t++)this.generateFood();else this.refreshFoodCount=1;(this.refreshSnakeCount-=e,this.refreshSnakeCount<=0)&&(cc.find("Canvas/snakeCollection").childrenCount<6&&this.generateSnake())}}),cc._RF.pop()},{Global:"Global"}],Global:[function(e,t,n){"use strict";cc._RF.push(t,"616f8EefpJKEIN73I/0d5tR","Global"),t.exports={speed:null,angle:null,SnakeSkin:cc.Enum({Brown:0,Yellow:1,Green:2,Red:3,Bee:4,Rock:5,Hat:6,Pikachu:7}),HEAD_TAG:0,SENSOR_TAG:1,BODY_TAG:2,FOOD_TAG:3,SCORE_LV:5,SKIN_TYPE:[{head:"skin1-1",body:"skin1-2"},{head:"skin2-1",body:"skin2-2"},{head:"skin3-1",body:"skin3-2"},{head:"skin4-1",body:"skin4-2"},{head:"skin5-1",body:"skin5-2"},{head:"skin6-1",body:"skin6-2"},{head:"skin7-1",body:"skin7-2"},{head:"skin8-1",body:"skin8-2"},{head:"skin9-1",body:"skin9-2"}]},cc._RF.pop()},{}],SnakeCamera:[function(e,t,n){"use strict";cc._RF.push(t,"06fa9akUABIDqy38/VfwX44","SnakeCamera"),cc.Class({extends:cc.Component,properties:{role:{default:null,type:cc.Node}},start:function(){this.role=cc.find("Canvas/snakeCollection/role/head")},setTarget:function(e){this.role=e},removeNode:function(){this.role=null},update:function(e){this.role&&(this.node.position=this.role.position)}}),cc._RF.pop()},{}],aiCtrl:[function(e,t,n){"use strict";cc._RF.push(t,"9fbfb8BArhBarFVxvQu7ncI","aiCtrl");var o=e("Global");cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.boundryInterval=0,this.enemyInterval=0,this.safeDistance=100,this.inDanger=!1,this.head=this.node.getChildByName("head")},keepAwayDanger:function(){var e=this.head.position,t=this.head.angle*Math.PI/180,n=new cc.Vec2(Math.cos(t)*this.safeDistance,Math.sin(t)*this.safeDistance);if(e.addSelf(n),e.x>o.mapRect.xMax||e.x<o.mapRect.xMin||e.y>o.mapRect.yMax||e.y<o.mapRect.yMin){if(this.boundryInterval<=0){this.boundryInterval=o.boundryInterval;var a=this.node.getComponent("snake");this.node.getComponent("snake").setAngle((a.getAngle()+180)%360)}}else if(this.inDanger){if(this.enemyInterval<=0){this.enemyInterval=o.enemyInterval;a=this.node.getComponent("snake");this.node.getComponent("snake").setAngle((a.getAngle()+180)%360)}this.inDanger=!1}},start:function(){},update:function(e){this.boundryInterval=this.boundryInterval<=0?this.boundryInterval:this.boundryInterval-e,this.enemyInterval=this.enemyInterval<=0?this.enemyInterval:this.enemyInterval-e,this.keepAwayDanger()}}),cc._RF.pop()},{Global:"Global"}],buttonAcc:[function(e,t,n){"use strict";cc._RF.push(t,"6f4405+VQFLuLAdGqikGErr","buttonAcc"),cc.Class({extends:cc.Component,properties:{snake:{default:null,type:cc.Node}},onLoad:function(){},removeTarget:function(){this.snake=null},setTarget:function(e){this.snake=e},start:function(){this.node.on(cc.Node.EventType.TOUCH_START,function(e){this.snake&&this.snake.getComponent("snake").accerlate()},this),this.node.on(cc.Node.EventType.TOUCH_END,function(e){this.snake&&this.snake.getComponent("snake").decerlate()},this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(e){this.snake&&this.snake.getComponent("snake").decerlate()},this)}}),cc._RF.pop()},{}],playerCtrl:[function(e,t,n){"use strict";cc._RF.push(t,"e7ab4K5IvVI2YjwCqwgrp96","playerCtrl"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){window.EventMgr.on("dir-change",function(e){this.node.getComponent("snake").setAngle(e)}.bind(this),this)},refresh:function(){},start:function(){}}),cc._RF.pop()},{}],rocker:[function(e,t,n){"use strict";cc._RF.push(t,"a20ea2osbpAKpHOFLboBUUS","rocker");var o=function(e){var t=Math.atan(e.y/e.x);return(e.x<0&&e.y>0||e.x<0&&e.y<0)&&(t+=Math.PI),(180*t/Math.PI+360)%360};cc.Class({extends:cc.Component,properties:{radius:{default:0,type:cc.Integer}},onLoad:function(){this.actLength=5,this.radius=40,this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchedBegan,this,!1),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchedMoved,this,!1),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchedEnded,this,!1),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchedCancelled,this,!1)},onTouchedBegan:function(e,t){var n=e.getLocation();return n=this.node.parent.convertToNodeSpaceAR(n),!!this.node.getBoundingBox().contains(n)&&(this.node.stopAllActions(),n.mag()>this.actLength&&window.EventMgr.emit("dir-change",o(n)),!0)},onTouchedMoved:function(e,t){var n=e.getLocation();(n=this.node.parent.convertToNodeSpaceAR(n)).mag()>this.radius?this.node.position=n.normalize().mul(this.radius):this.node.position=this.node.position.add(e.getDelta()),n.mag()>this.actLength&&window.EventMgr.emit("dir-change",o(n))},onTouchedEnded:function(e,t){if(this.node.position!=cc.Vec2.ZERO){this.node.stopAllActions();var n=this.node.position.mag()/this.radius;this.node.runAction(new cc.MoveTo(.2*n,0,0))}},onTouchedCancelled:function(e,t){if(this.node.position!=cc.Vec2.ZERO){this.node.stopAllActions();var n=this.node.position.mag()/this.radius;this.node.runAction(new cc.MoveTo(.2*n,0,0))}},start:function(){}}),cc._RF.pop()},{}],snake_body:[function(e,t,n){"use strict";cc._RF.push(t,"c40ad1n8Y5MOYgpXGkCIupP","snake_body");var o=function(e){return e>180?-360+e:e<-180?360+e:e};cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.streak=[]},clearData:function(){this.streak=[]},start:function(){this.snake=this.node.parent.getComponent("snake"),this.gap=this.snake.gap},addStreak:function(e){this.streak.push(e)},setMovement:function(e){var t,n=!1,a=this.streak,i=this.gap;for(t=a.length-1;t>0;t--){if((d=a[t].pos.sub(a[t-1].pos)).mag()>i){n=!0;var s=i/d.mag();d.normalizeSelf();var c=a[t-1].pos.add(d.mulSelf((1-s)*i));p=((p=a[t-1].angle+o(a[t].angle-a[t-1].angle)*(1-s))+360)%360;break}i-=d.mag()}if(n)for(var r=0;r<t;r++)this.streak.shift();else{var d,h=this.node.position,l=this.node.angle;if(a[t].pos.sub(this.node.position,d),d.mag()>i){s=i/d.mag();d.normalizeSelf();var p;c=h.add(d.mulSelf((1-s)*i));p=((p=l+o(a[t].angle-l)*(1-s))+360)%360}else c=this.node.position,p=this.node.angle}this.node.position=c,this.node.angle=p}}),cc._RF.pop()},{}],snake_head:[function(e,t,n){"use strict";cc._RF.push(t,"99036A3ZGNHWLZC8ro1XxA6","snake_head");var o=e("Global");cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.curAngle=0,this.targetAngle=0,this.speed=o.speed},start:function(){},setSpeed:function(e){this.speed=e},move:function(e){var t=this.curAngle*(Math.PI/180),n=new cc.Vec2(Math.cos(t)*this.speed*e,Math.sin(t)*this.speed*e);this.node.position=new cc.Vec2(n.x+this.node.position.x,n.y+this.node.position.y)},rotate:function(e){if(this.curAngle.toFixed(2)!=this.targetAngle.toFixed(2)){var t=this.targetAngle-this.curAngle;Math.abs(t)>180?this.curAngle+=-Math.sign(t)*e*o.angle:this.curAngle+=Math.sign(t)*e*o.angle,Math.sign(this.targetAngle-this.curAngle)!=Math.sign(t)?this.curAngle=this.targetAngle:this.curAngle=(this.curAngle+360)%360,this.node.angle=this.curAngle}}}),cc._RF.pop()},{Global:"Global"}],snake:[function(e,t,n){"use strict";cc._RF.push(t,"b0c74o6QD9Hv5stPZqfDuwZ","snake");var o=e("Global");cc.Class({extends:cc.Component,properties:{skin:{default:o.SnakeSkin.Brown,type:cc.Enum(o.SnakeSkin)}},onLoad:function(){this.length=2,this.gap=40,this.score=5,this.bodyList=[],this.bodyList[0]=this.node.getChildByName("head"),this.bodyList[1]=this.node.getChildByName("body"),this.setSkin(this.skin),this.reset()},start:function(){for(var e=1;e<this.bodyList.length;e++){var t=this.bodyList[e-1],n={pos:t.position,angle:t.angle};this.bodyList[e].getComponent("snake_body").addStreak(n)}},reset:function(){for(var e=this.getAngle(),t=1;t<this.bodyList.length;t++){var n=this.bodyList[t-1].position;this.bodyList[t].angle=e;var o=e*Math.PI/180;this.bodyList[t].position=new cc.Vec2(n.x-Math.cos(o)*this.gap,n.y-Math.sin(o)*this.gap)}},setPos:function(e){this.bodyList[0].position=e,this.reset()},setSkin:function(e){this.skin=e;var t=o.SKIN_TYPE[e];this.bodyList[0].getComponent(cc.Sprite).spriteFrame=o.pics.getSpriteFrame(t.head),this.bodyList[1].getComponent(cc.Sprite).spriteFrame=o.pics.getSpriteFrame(t.body)},setAngle:function(e){this.bodyList[0].getComponent("snake_head").targetAngle=e},getAngle:function(){return this.bodyList[0].getComponent("snake_head").curAngle},addNode:function(){var e=cc.find("Canvas/GameControl").getComponent("GameCtrl").getSnakeBody();e.getComponent(cc.Sprite).spriteFrame=o.pics.getSpriteFrame(o.SKIN_TYPE[this.skin].body),e.parent=this.node,e.zIndex=-this.length,e.group=this.bodyList[0].group;var t=this.bodyList[this.length-1],n=t.angle*Math.PI/180,a={pos:t.position,angle:t.angle};e.position=new cc.Vec2(t.position.x-Math.cos(n)*this.gap,t.position.y-Math.sin(n)*this.gap),e.angle=t.angle,this.bodyList.push(e),e.getComponent("snake_body").addStreak(a),this.length++},removeNode:function(){var e=cc.find("Canvas/GameControl").getComponent("GameControl").bodyPool,t=this.bodyList.pop();e.put(t)},movement:function(e){var t=this.bodyList[0].getComponent("snake_head");t.rotate(e),t.move(e);for(var n=1;n<this.bodyList.length;n++){var o=this.bodyList[n-1],a={pos:new cc.Vec2(o.position.x,o.position.y),angle:o.angle};this.bodyList[n].getComponent("snake_body").addStreak(a),(t=this.bodyList[n].getComponent("snake_body")).setMovement(e)}},addScore:function(){this.score+=1,Math.floor(this.score/o.SCORE_LV)>this.length-1&&this.addNode()},accerlate:function(){this.bodyList[0].getComponent("snake_head").setSpeed(2*o.speed)},decerlate:function(){this.bodyList[0].getComponent("snake_head").setSpeed(o.speed)},update:function(e){this.movement(e);var t=this.bodyList[0];(t.x+25>o.mapRect.xMax||t.x-25<o.mapRect.xMin||t.y+25>o.mapRect.yMax||t.y-25<o.mapRect.yMin)&&cc.find("Canvas/GameControl").getComponent("GameCtrl").destroySnake(this.node)}}),cc._RF.pop()},{Global:"Global"}],test:[function(e,t,n){"use strict";cc._RF.push(t,"a23db30yjZHIJp1KAVB+cwI","test"),cc.Class({extends:cc.Component,properties:{},start:function(){},update:function(e){}}),cc._RF.pop()},{}]},{},["ColliderListener_food","ColliderListener_snake","EventMgr","GameCtrl","Global","SnakeCamera","aiCtrl","buttonAcc","playerCtrl","rocker","snake","snake_body","snake_head","test"]);